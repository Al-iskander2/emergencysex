{% extends 'budsidesk_app/base.html' %}
{% load static %}
{% block content %}

<div style="max-width: 1100px; margin: 32px auto; padding: 0 20px;">
  <h1 style="text-align: center; color: #4B49AC;">Invoice #{{ invoice.invoice_number }}</h1>
  <p style="text-align: center; color: #6b7a90;">Created on {{ invoice.date|date:"F d, Y" }}</p>

  <div style="display: grid; grid-template-columns: 1fr; gap: 24px;">
    <!-- LEFT: Preview -->
    <div style="background: #fff; border: 1px solid rgba(75, 73, 172, 0.18); border-radius: 16px; box-shadow: 0 10px 24px rgba(75, 73, 172, 0.10);">
      <h2 style="margin: 0; padding: 16px 18px; border-bottom: 1px solid rgba(75, 73, 172, 0.18); color: #4B49AC; font-size: 18px;">Invoice Preview</h2>
      <div style="padding: 18px;">
        {% if original_url %}
          <div style="display: flex; align-items: center; justify-content: center; background: #f6f8ff; border: 1px dashed rgba(75, 73, 172, 0.35); border-radius: 12px; min-height: 400px; overflow: hidden;">
            {% if is_pdf %}
              <embed src="{{ original_url }}" type="application/pdf" style="width: 100%; height: 500px;"/>
            {% else %}
              <img src="{{ original_url }}" alt="invoice preview" style="max-width: 100%; max-height: 500px; object-fit: contain;"/>
            {% endif %}
          </div>
        {% else %}
          <div style="display: flex; align-items: center; justify-content: center; background: #f6f8ff; border: 1px dashed rgba(75, 73, 172, 0.35); border-radius: 12px; min-height: 400px; color: #6b7a90;">
            <div style="text-align: center;">
              <i class="fas fa-file-invoice" style="font-size: 3rem; margin-bottom: 1rem;"></i>
              <p>No preview available</p>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    <!-- RIGHT: Invoice Information (SOLO LECTURA) -->
    <div style="background: #fff; border: 1px solid rgba(75, 73, 172, 0.18); border-radius: 16px; box-shadow: 0 10px 24px rgba(75, 73, 172, 0.10);">
      <h2 style="margin: 0; padding: 16px 18px; border-bottom: 1px solid rgba(75, 73, 172, 0.18); color: #4B49AC; font-size: 18px;">Invoice Details</h2>
      <div style="padding: 18px;">
        
        <!-- Información de la factura en modo solo lectura -->
        <div style="display: grid; grid-template-columns: 1fr; gap: 16px;">
          <div>
            <label style="font-weight: 600; color: #2a3550; font-size: 14px; display: block; margin-bottom: 8px;">Client</label>
            <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; color: #4B49AC; font-weight: 500;">
              {{ invoice.contact.name }}
            </div>
          </div>
          
          <div>
            <label style="font-weight: 600; color: #2a3550; font-size: 14px; display: block; margin-bottom: 8px;">Date</label>
            <div style="padding: 12px; background: #f8f9fa; border-radius: 8px;">
              {{ invoice.date }}
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 14px;">
            <div>
              <label style="font-weight: 600; color: #2a3550; font-size: 14px; display: block; margin-bottom: 8px;">Subtotal</label>
              <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; font-weight: 600;">
                €{{ invoice.subtotal }}
              </div>
            </div>
            <div>
              <label style="font-weight: 600; color: #2a3550; font-size: 14px; display: block; margin-bottom: 8px;">VAT</label>
              <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; font-weight: 600;">
                €{{ invoice.vat_amount }}
              </div>
            </div>
          </div>
          
          <div>
            <label style="font-weight: 600; color: #2a3550; font-size: 14px; display: block; margin-bottom: 8px;">Total</label>
            <div style="padding: 12px; background: #f6f8ff; border: 2px solid rgba(75, 73, 172, 0.2); border-radius: 8px; font-weight: 700; color: #4B49AC; font-size: 18px;">
              €{{ invoice.total }}
            </div>
          </div>

          {% if invoice.description %}
          <div>
            <label style="font-weight: 600; color: #2a3550; font-size: 14px; display: block; margin-bottom: 8px;">Description</label>
            <div style="padding: 12px; background: #f8f9fa; border-radius: 8px; min-height: 60px;">
              {{ invoice.description|linebreaks }}
            </div>
          </div>
          {% endif %}
        </div>

        <!-- Botones de acción -->
        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 24px;">
          {% if invoice.original_file %}
          <a href="{{ invoice.original_file.url }}" download 
             style="background: #4B49AC; color: white; border: none; border-radius: 12px; padding: 12px 24px; font-weight: 700; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
            <i class="fas fa-download"></i> Download
          </a>
          {% endif %}
          
          <a href="{% url 'main_expenses' %}" 
             style="background: #fff; border: 2px solid #4B49AC; color: #4B49AC; border-radius: 12px; padding: 12px 24px; font-weight: 700; text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
            <i class="fas fa-arrow-left"></i> Back to List
          </a>
          

        </div>
      </div>
    </div>
  </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
.action-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 6px;
  background: #f8f9ff;
  border: 1px solid rgba(75, 73, 172, 0.2);
  color: #4B49AC;
  text-decoration: none;
  transition: all 0.3s ease;
  cursor: pointer;
  font-size: 0.8rem;
}

.action-btn:hover {
  background: #4B49AC;
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(75, 73, 172, 0.3);
}
</style>

{% endblock %}